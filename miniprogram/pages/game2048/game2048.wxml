<!--game2048.wxml-->
<view class="container" bindtouchstart="touchStart" bindtouchend="touchEnd">
  
  <!-- 顶部状态栏 -->
  <view class="status-bar">
    <view class="score-box">
      <text class="score-label">SCORE</text>
      <text class="score-value">{{score}}</text>
      <view wx:if="{{scoreAdded > 0}}" class="score-add">+{{scoreAdded}}</view>
    </view>
    <view class="score-box best">
      <text class="score-label">BEST</text>
      <text class="score-value">{{bestScore}}</text>
    </view>
  </view>

  <!-- 2048 棋盘 -->
  <view class="board-container">
    <view class="game-board">
      
      <!-- 背景网格（始终显示空位置） -->
      <view class="grid-container">
        <view class="grid-row" wx:for="{{[0,1,2,3]}}" wx:key="*this">
          <view class="grid-cell" wx:for="{{[0,1,2,3]}}" wx:key="*this"></view>
        </view>
      </view>
      
      <!-- 活动的数字块 -->
      <view class="tile-container">
        <!-- 使用 tiles 数组渲染，key 使用 id 以确保复用和动画 -->
        <view 
          wx:for="{{tiles}}" 
          wx:key="id"
          class="tile tile-{{item.value}} tile-position-{{item.row}}-{{item.col}}"
        >
          <view class="tile-inner">{{item.value}}</view>
        </view>
      </view>

      <!-- 游戏结束/胜利 覆盖层 -->
      <view wx:if="{{gameOver || gameWon}}" class="game-message {{gameOver ? 'game-over' : 'game-won'}}">
        <text class="message-text">{{gameOver ? 'Game Over!' : 'You Win!'}}</text>
        <view class="message-actions">
           <button class="retry-btn" bindtap="restartGame">Try again</button>
           <button wx:if="{{gameWon}}" class="keep-playing-btn" bindtap="keepPlaying">Keep going</button>
        </view>
      </view>

    </view>
  </view>

  <!-- 工具栏 -->
  <view class="controls-area">
    <view class="tool-btn {{history.length === 0 ? 'disabled' : ''}}" bindtap="undoMove">
      <view class="icon-circle">↶</view>
      <text>回退</text>
    </view>
    
    <view class="tool-btn" bindtap="restartGame">
      <view class="icon-circle">↺</view>
      <text>新游戏</text>
    </view>
  </view>



</view>

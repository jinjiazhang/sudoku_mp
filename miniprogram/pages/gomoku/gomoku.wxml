<!--gomoku.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-header">
    <view class="player-pill {{game.currentPlayer === 1 ? 'active-black' : ''}}">
      <view class="stone-icon black"></view>
      <text class="player-name">é»‘æ–¹</text>
    </view>

    <view class="game-info">
      <view class="status-text">
        <block wx:if="{{gameMode === 'pvp'}}">
          <text>{{game.currentPlayer === 1 ? 'é»‘æ–¹æ€è€ƒ' : 'ç™½æ–¹æ€è€ƒ'}}</text>
        </block>
        <block wx:else>
          <text>{{(game.currentPlayer === 1 && playerColor === 'black') || (game.currentPlayer === 2 && playerColor === 'white') ? 'ä½ çš„å›åˆ' : 'AIæ€è€ƒ'}}</text>
        </block>
      </view>
      <view class="timer">{{formattedTime}}</view>
    </view>

    <view class="player-pill {{game.currentPlayer === 2 ? 'active-white' : ''}}">
      <text class="player-name">ç™½æ–¹</text>
      <view class="stone-icon white"></view>
    </view>
  </view>

  <!-- æ£‹ç›˜åŒºåŸŸ -->
  <view class="board-area">
    <view class="gomoku-board">
      <view
        wx:for="{{boardData}}"
        wx:for-item="row"
        wx:for-index="rowIndex"
        wx:key="row-{{rowIndex}}"
        class="board-row"
      >
        <view
          wx:for="{{row}}"
          wx:for-item="cell"
          wx:for-index="colIndex"
          wx:key="cell-{{rowIndex}}-{{colIndex}}"
          class="cell {{cell.position}}"
          bindtap="onCellTap"
          data-row="{{cell.row}}"
          data-col="{{cell.col}}"
        >
          <!-- ç½‘æ ¼çº¿ -->
          <view class="line horizontal"></view>
          <view class="line vertical"></view>
          
          <!-- æ˜Ÿä½ -->
          <view wx:if="{{cell.isStarPoint}}" class="star-point"></view>

          <!-- æ£‹å­ -->
          <view
            wx:if="{{cell.stone !== 0}}"
            class="stone {{cell.stone === 1 ? 'black' : 'white'}} {{cell.isLast ? 'last-move' : ''}} {{cell.isWinning ? 'winning' : ''}}"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- å·¥å…·æ  -->
  <view class="controls-area">
    <view class="tool-btn {{(gameMode === 'pvp' ? game.moveHistory.length < 1 : game.moveHistory.length < 2) || game.gameOver || isThinking ? 'disabled' : ''}}" bindtap="undoMove">
      <view class="icon-circle">â†¶</view>
      <text>æ‚”æ£‹</text>
    </view>

    <view class="tool-btn" bindtap="restartGame">
      <view class="icon-circle">â†º</view>
      <text>é‡æ–°å¼€å§‹</text>
    </view>
  </view>
</view>

<!-- æ¸¸æˆç»“æŸå¯¹è¯æ¡† -->
<view wx:if="{{showCompleteDialog}}" class="dialog-mask">
  <view class="result-card {{game.winner === 1 ? 'win-black' : game.winner === 2 ? 'win-white' : 'draw'}}">
    <view class="result-icon">{{game.winner === 1 ? 'âš«' : game.winner === 2 ? 'âšª' : 'ğŸ¤'}}</view>
    <text class="result-title">{{resultText}}</text>
    <text class="result-time">è€—æ—¶ {{formattedTime}}</text>
    
    <view class="result-actions">
      <button class="action-btn primary" bindtap="playAgain">å†æ¥ä¸€å±€</button>
      <button class="action-btn secondary" bindtap="backToHome">è¿”å›ä¸»é¡µ</button>
    </view>
  </view>
</view>
